/**
*
*   FILTER.js Plugins
*   @version: 0.6.14
*   @dependencies: Filter.js
*
*   JavaScript Image Processing Library (Plugins)
*   https://github.com/foo123/FILTER.js
*
**/!function(r,t,e,n,a){"use strict";var i="undefined"!=typeof global&&"[object global]"==={}.toString.call(global),l=!i&&"undefined"!=typeof navigator,o="function"==typeof importScripts&&navigator instanceof WorkerNavigator,s=Array,u=s.prototype,c=function(){var r=null;if(i)return r=__filename,{path:__dirname,file:__filename};if(o)r=self.location.href;else if(l){var t;(t=document.getElementsByTagName("script"))&&t.length&&(r=t[t.length-1].src)}return r?{path:r.split("/").slice(0,-1).join("/"),file:r}:{path:null,file:null}},f=c(),h=function(r,t){if(i)return t;if("."==t.charAt(0)){r=r.split("/"),t=t.split("/");var e,n=0,a=0,l=t.length,o=r.length;for(e=0;l>e;e++)if(/^\.\./.test(t[e]))n++,a++;else{if(!/^\./.test(t[e]))break;a++}n=n>=o?0:o-n,t=r.slice(0,n).concat(t.slice(a)).join("/")}return t};e=e?[].concat(e):[];var p,m,d,g=e.length,v=new s(g),_=new s(g),C=new s(g),b=new s(g);for(p=0;g>p;p++)v[p]=e[p][0],_[p]=e[p][1],C[p]=/\.js$/i.test(_[p])?h(f.path,_[p]):h(f.path,_[p]+".js");if("object"==typeof module&&module.exports){if(a===module.exports[t]){for(p=0;g>p;p++)b[p]=module.exports[v[p]]||require(C[p])[v[p]];m=n.apply(r,b),module.exports[t]=m||1}}else if("function"==typeof define&&define.amd)define(["exports"].concat(_),function(e){if(a===e[t]){for(var i=u.slice.call(arguments,1),l=i.length,o=0;l>o;o++)b[o]=e[v[o]]||i[o];m=n.apply(r,b),e[t]=m||1}});else if(o){for(p=0;g>p;p++)self[v[p]]||importScripts(C[p]),b[p]=self[v[p]];m=n.apply(r,b),self[t]=m||1}else if(a===r[t]){var M=function(r,t){d=d||document.getElementsByTagName("head")[0];var e=0,n=document.createElement("script");n.type="text/javascript",n.language="javascript",n.onload=n.onreadystatechange=function(){e||n.readyState&&"loaded"!=n.readyState&&"complete"!=n.readyState||(e=1,n.onload=n.onreadystatechange=null,d.removeChild(n),n=null,t&&t())},n.src=r,d.appendChild(n)},y=function(t,e,n){r[t]?n():M(e,n)},O=function(e){return function(){g>e&&(b[e]=r[v[e]]),++e<g?y(v[e],C[e],O(e)):(m=n.apply(r,b),r[t]=m||1)}};g?y(v[0],C[0],O(0)):(m=n.apply(r,b),r[t]=m||1)}}(this.self||this,"FILTER_PLUGINS",[["FILTER","./filter"]],function(r){var t=null;return!function(r){"use strict";var t=r._notSupportClamp,e=Math.random;r.NoiseFilter=r.Create({name:"NoiseFilter",min:-127,max:127,init:function(r,t){var e=this;e.min=r||-127,e.max=t||127},path:r.getPath(),serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{min:r.min,max:r.max}}},unserialize:function(r){var t,e=this;return r&&e.name===r.filter&&(e._isOn=!!r._isOn,t=r.params,e.min=t.min,e.max=t.max),e},apply:function(r){var n=this;if(!n._isOn)return r;var a,i,l,o,s,u,c,f,h=n.max-n.min,p=n.min,m=r.length;if(t)for(a=0;m>a;a+=4)l=r[a],o=r[a+1],s=r[a+2],i=h*e()+p,u=l+i,c=o+i,f=s+i,0>u?u=0:u>255&&(u=255),0>c?c=0:c>255&&(c=255),0>f?f=0:f>255&&(f=255),r[a]=~~u,r[a+1]=~~c,r[a+2]=~~f;else for(a=0;m>a;a+=4)l=r[a],o=r[a+1],s=r[a+2],i=h*e()+p,u=l+i,c=o+i,f=s+i,r[a]=~~u,r[a+1]=~~c,r[a+2]=~~f;return r}})}(r),!function(r){"use strict";var t=r._notSupportClamp,e=r.Array32F,n=r.Color.RGB2YCbCr,a=r.Color.YCbCr2RGB;r.HistogramEqualizeFilter=r.Create({name:"HistogramEqualizeFilter",path:r.getPath(),apply:function(r){var i=this;if(!i._isOn)return r;var l,o,s,u,c,f,h,p,m,d,g,v=0,_=255,C=0,b=r.length,M=b>>2,y=1/M;for(c=new e(256),m=0;256>m;m+=4)c[m]=0,c[m+1]=0,c[m+2]=0,c[m+3]=0;for(m=0;b>m;m+=4)l=r[m],o=r[m+1],s=r[m+2],d=n({r:l,g:o,b:s}),l=r[m]=~~d.cr,o=r[m+1]=~~d.y,s=r[m+2]=~~d.cb,c[o]+=y,o>v?v=o:_>o&&(_=o);for(C=0,m=0;256>m;m+=4)C+=c[m],c[m]=C,C+=c[m+1],c[m+1]=C,C+=c[m+2],c[m+2]=C,C+=c[m+3],c[m+3]=C;if(u=v-_,t)for(m=0;b>m;m+=4)d={cr:r[m],y:r[m+1],cb:r[m+2]},d.y=c[d.y]*u+_,g=a(d),f=g.r,h=g.g,p=g.b,f=0>f?0:f>255?255:f,h=0>h?0:h>255?255:h,p=0>p?0:p>255?255:p,r[m]=~~f,r[m+1]=~~h,r[m+2]=~~p;else for(m=0;b>m;m+=4)d={cr:r[m],y:r[m+1],cb:r[m+2]},d.y=c[d.y]*u+_,g=a(d),r[m]=~~g.r,r[m+1]=~~g.g,r[m+2]=~~g.b;return r}})}(r),!function(r){"use strict";var t=r._notSupportClamp,e=r.Array32F;r.GrayscaleHistogramEqualizeFilter=r.Create({name:"GrayscaleHistogramEqualizeFilter",path:r.getPath(),apply:function(r){var n=this;if(!n._isOn)return r;var a,i,l,o,s,u=0,c=255,f=0,h=r.length,p=h>>2,m=1/p;for(o=new e(256),s=0;256>s;s+=4)o[s]=0,o[s+1]=0,o[s+2]=0,o[s+3]=0;for(s=0;h>s;s+=4)a=r[s],o[a]+=m,a>u?u=a:c>a&&(c=a);for(f=0,s=0;256>s;s+=4)f+=o[s],o[s]=f,f+=o[s+1],o[s+1]=f,f+=o[s+2],o[s+2]=f,f+=o[s+3],o[s+3]=f;if(l=u-c,t)for(s=0;h>s;s+=4)a=r[s],i=o[a]*l+c,i=0>i?0:i>255?255:i,i=~~i,r[s]=i,r[s+1]=i,r[s+2]=i;else for(s=0;h>s;s+=4)a=r[s],i=~~(o[a]*l+c),r[s]=i,r[s+1]=i,r[s+2]=i;return r}})}(r),!function(r){"use strict";var t=r._notSupportClamp,e=r.Array32F;r.RGBHistogramEqualizeFilter=r.Create({name:"RGBHistogramEqualizeFilter",path:r.getPath(),apply:function(r){var n=this;if(!n._isOn)return r;var a,i,l,o,s,u,c,f,h,p,m,d,g,v,_,C,b=0,M=0,y=0,O=255,F=255,z=255,I=r.length,Y=I>>2,k=1/Y;for(c=new e(256),f=new e(256),h=new e(256),C=0;256>C;C+=4)c[C]=0,f[C]=0,h[C]=0,c[C+1]=0,f[C+1]=0,h[C+1]=0,c[C+2]=0,f[C+2]=0,h[C+2]=0,c[C+3]=0,f[C+3]=0,h[C+3]=0;for(C=0;I>C;C+=4)a=r[C],i=r[C+1],l=r[C+2],c[a]+=k,f[i]+=k,h[l]+=k,a>b?b=a:O>a&&(O=a),i>M?M=i:F>i&&(F=i),l>y?y=l:z>l&&(z=l);for(p=m=d=0,C=0;256>C;C+=4)p+=c[C],c[C]=p,m+=f[C],f[C]=m,d+=h[C],h[C]=d,p+=c[C+1],c[C+1]=p,m+=f[C+1],f[C+1]=m,d+=h[C+1],h[C+1]=d,p+=c[C+2],c[C+2]=p,m+=f[C+2],f[C+2]=m,d+=h[C+2],h[C+2]=d,p+=c[C+3],c[C+3]=p,m+=f[C+3],f[C+3]=m,d+=h[C+3],h[C+3]=d;if(o=b-O,s=M-F,u=y-z,t)for(C=0;I>C;C+=4)a=r[C],i=r[C+1],l=r[C+2],g=c[a]*o+O,v=f[i]*s+F,_=h[l]*u+z,g=0>g?0:g>255?255:g,v=0>v?0:v>255?255:v,_=0>_?0:_>255?255:_,r[C]=~~g,r[C+1]=~~v,r[C+2]=~~_;else for(C=0;I>C;C+=4)a=r[C],i=r[C+1],l=r[C+2],g=c[a]*o+O,v=f[i]*s+F,_=h[l]*u+z,r[C]=~~g,r[C+1]=~~v,r[C+2]=~~_;return r}})}(r),!function(r){"use strict";var t=Math.sqrt,e=r._notSupportClamp,n=r.Array32F;r.PixelateFilter=r.Create({name:"PixelateFilter",scale:1,init:function(r){var t=this;t.scale=r||1},path:r.getPath(),serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{scale:r.scale}}},unserialize:function(r){var t,e=this;return r&&e.name===r.filter&&(e._isOn=!!r._isOn,t=r.params,e.scale=t.scale),e},apply:function(r,a,i){var l=this;if(!l._isOn||l.scale<=1)return r;l.scale>100&&(l.scale=100);var o,s,u,c,f,h,p,m,d,g,v,_,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E,A,P,q,H,B,N,R,G,L,T,j,V,D,U,Q,W,$,J,K,Z=r.length,rt=Z>>2,tt=(a<<1)+a;for(o=~~(t(rt)*l.scale*.01),s=a*o,u=i%o,c=a%o,f=(u-1)*a,d=1/(o*o),g=1/(c*o),v=1/(u*o),_=1/(c*u),C=d,b=g,M=v,y=_,Y=o-1,k=(o-1)*a,L=0,j=a-1,T=0,V=rt-a,O=new n(3*rt),X=0,S=0,x=0,F=z=I=0,x=0;a>x;x++,X+=4,S+=3)F+=r[X],z+=r[X+1],I+=r[X+2],O[S]=F,O[S+1]=z,O[S+2]=I;for(S=0,x=0,F=z=I=0,X=tt+a;Z>X;X+=4,S+=3,x++)x>=a&&(x=0,F=z=I=0),F+=r[X],z+=r[X+1],I+=r[X+2],O[S+tt]=O[S]+F,O[S+tt+1]=O[S+1]+z,O[S+tt+2]=O[S+2]+I;for(x=0,w=0,E=0,B=x,N=E,R=B+Y,G=N+k,R=R>j?j:R,G=G>V?V:G,D=B+N,W=R+G,U=R+N,Q=B+G,D=(D<<1)+D,U=(U<<1)+U,Q=(Q<<1)+Q,W=(W<<1)+W,m=C,$=m*(O[W]-O[U]-O[Q]+O[D]),J=m*(O[W+1]-O[U+1]-O[Q+1]+O[D+1]),K=m*(O[W+2]-O[U+2]-O[Q+2]+O[D+2]),e&&($=0>$?0:$>255?255:$,J=0>J?0:J>255?255:J,K=0>K?0:K>255?255:K),$=~~$,J=~~J,K=~~K,A=0,P=0,q=0,X=0;Z>X;X+=4)H=A+x+q+E<<2,r[H]=$,r[H+1]=J,r[H+2]=K,A++,(A+x>=a||A>=o)&&(A=0,P++,q+=a),(P+w>=i||P>=o)&&(x+=o,x>=a&&(x=0,w+=o,E+=s),A=0,P=0,q=0,B=x,N=E,R=B+Y,G=N+k,R=R>j?j:R,G=G>V?V:G,D=B+N,W=R+G,U=R+N,Q=B+G,D=(D<<1)+D,U=(U<<1)+U,Q=(Q<<1)+Q,W=(W<<1)+W,h=0==R-B-c+1,p=0==G-N-f,m=h&&p?y:h?b:p?M:C,$=m*(O[W]-O[U]-O[Q]+O[D]),J=m*(O[W+1]-O[U+1]-O[Q+1]+O[D+1]),K=m*(O[W+2]-O[U+2]-O[Q+2]+O[D+2]),e&&($=0>$?0:$>255?255:$,J=0>J?0:J>255?255:J,K=0>K?0:K>255?255:K),$=~~$,J=~~J,K=~~K);return r}})}(r),!function(r){"use strict";var t=Math.sqrt,e=(Math.SQRT2,Math.min,r._notSupportClamp),n=r.Array32F;r.TriangularPixelateFilter=r.Create({name:"TriangularPixelateFilter",scale:1,init:function(r){var t=this;t.scale=r||1},path:r.getPath(),serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{scale:r.scale}}},unserialize:function(r){var t,e=this;return r&&e.name===r.filter&&(e._isOn=!!r._isOn,t=r.params,e.scale=t.scale),e},apply:function(r,a,i){var l=this;if(!l._isOn||l.scale<=1)return r;l.scale>100&&(l.scale=100);var o,s,u,c,f,h,p,m,d,g,v,_,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E,A,P,q,H,B,N,R,G,L,T,j,V,D,U,Q,W,$,J,K,Z,rt,tt,et,nt,at,it,lt,ot=r.length,st=ot>>2,ut=(a<<1)+a;for(o=~~(t(st)*l.scale*.01),s=o>>1,u=o-1,c=a*o,f=i%o,h=a%o,p=(f-1)*a,v=1/(o*o),_=1/(h*o),C=1/(f*o),b=1/(h*f),M=2*v,y=2*_,O=2*C,F=2*b,X=u,S=u*a,j=0,D=a-1,V=0,U=st-a,z=new n(3*st),x=0,w=0,E=0,I=Y=k=0,E=0;a>E;E++,x+=4,w+=3)I+=r[x],Y+=r[x+1],k+=r[x+2],z[w]=I,z[w+1]=Y,z[w+2]=k;for(w=0,E=0,I=Y=k=0,x=ut+a;ot>x;x+=4,w+=3,E++)E>=a&&(E=0,I=Y=k=0),I+=r[x],Y+=r[x+1],k+=r[x+2],z[w+ut]=z[w]+I,z[w+ut+1]=z[w+1]+Y,z[w+ut+2]=z[w+2]+k;for(E=0,A=0,P=0,R=E,G=P,L=E-s+X,T=P+S,L=L>D?D:L,T=T>U?U:T,Q=R+G,J=L+T,W=L+G,$=R+T,Q=(Q<<1)+Q,W=(W<<1)+W,$=($<<1)+$,J=(J<<1)+J,g=M,tt=g*(z[J]-z[W]-z[$]+z[Q]),et=g*(z[J+1]-z[W+1]-z[$+1]+z[Q+1]),nt=g*(z[J+2]-z[W+2]-z[$+2]+z[Q+2]),R=E+s,L=E+X,L=L>D?D:L,Q=R+G,J=L+T,W=L+G,$=R+T,Q=(Q<<1)+Q,W=(W<<1)+W,$=($<<1)+$,J=(J<<1)+J,at=g*(z[J]-z[W]-z[$]+z[Q]),it=g*(z[J+1]-z[W+1]-z[$+1]+z[Q+1]),lt=g*(z[J+2]-z[W+2]-z[$+2]+z[Q+2]),e&&(tt=0>tt?0:tt>255?255:tt,et=0>et?0:et>255?255:et,nt=0>nt?0:nt>255?255:nt,at=0>at?0:at>255?255:at,it=0>it?0:it>255?255:it,lt=0>lt?0:lt>255?255:lt),tt=~~tt,et=~~et,nt=~~nt,at=~~at,it=~~it,lt=~~lt,K=tt,Z=et,rt=nt,q=0,H=0,B=0,x=0;ot>x;x+=4)N=q+E+B+P<<2,r[N]=K,r[N+1]=Z,r[N+2]=rt,q++,(q+E>=a||q>=o)&&(q=0,H++,B+=a,K=tt,Z=et,rt=nt),q>u-H&&(K=at,Z=it,rt=lt),(H+A>=i||H>=o)&&(E+=o,E>=a&&(E=0,A+=o,P+=c),q=0,H=0,B=0,R=E,G=P,L=E-s+X,T=P+S,L=L>D?D:L,T=T>U?U:T,Q=R+G,J=L+T,W=L+G,$=R+T,Q=(Q<<1)+Q,W=(W<<1)+W,$=($<<1)+$,J=(J<<1)+J,m=0==L-R+s-h+1,d=0==T-G-p,g=m&&d?F:m?y:d?O:M,tt=g*(z[J]-z[W]-z[$]+z[Q]),et=g*(z[J+1]-z[W+1]-z[$+1]+z[Q+1]),nt=g*(z[J+2]-z[W+2]-z[$+2]+z[Q+2]),R=E+s,L=E+X,L=L>D?D:L,Q=R+G,J=L+T,W=L+G,$=R+T,Q=(Q<<1)+Q,W=(W<<1)+W,$=($<<1)+$,J=(J<<1)+J,m=0==L-R+s-h+1,g=m&&d?F:m?y:d?O:M,at=g*(z[J]-z[W]-z[$]+z[Q]),it=g*(z[J+1]-z[W+1]-z[$+1]+z[Q+1]),lt=g*(z[J+2]-z[W+2]-z[$+2]+z[Q+2]),e&&(tt=0>tt?0:tt>255?255:tt,et=0>et?0:et>255?255:et,nt=0>nt?0:nt>255?255:nt,at=0>at?0:at>255?255:at,it=0>it?0:it>255?255:it,lt=0>lt?0:lt>255?255:lt),tt=~~tt,et=~~et,nt=~~nt,at=~~at,it=~~it,lt=~~lt,K=tt,Z=et,rt=nt);return r}})}(r),!function(r){"use strict";var t=r._notSupportClamp,e=r.Color.RGB2HSV,n=.7083333333333334;r.HSVConverterFilter=r.Create({name:"HSVConverterFilter",path:r.getPath(),apply:function(r){var a=this;if(!a._isOn)return r;var i,l,o,s,u,c,f,h,p=r.length;if(t)for(s=0;p>s;s+=4)i=r[s],l=r[s+1],o=r[s+2],u=e({r:i,g:l,b:o}),c=u.h*n,h=255*u.s,f=u.v,0>c?c=0:c>255&&(c=255),0>f?f=0:f>255&&(f=255),0>h?h=0:h>255&&(h=255),r[s]=~~c,r[s+1]=~~f,r[s+2]=~~h;else for(s=0;p>s;s+=4)i=r[s],l=r[s+1],o=r[s+2],u=e({r:i,g:l,b:o}),c=u.h*n,h=255*u.s,f=u.v,r[s]=~~c,r[s+1]=~~f,r[s+2]=~~h;return r}})}(r),!function(r){"use strict";var t=(r._notSupportClamp,r.ImArray,r.Color.clampPixel),e=r.Color.RGB2HSV,n=(r.Color.HSV2RGB,r.Color.Color2RGBA);r.HueExtractorFilter=r.Create({name:"HueExtractorFilter",range:null,background:0,init:function(r,t){var e=this;e.range=r,e.background=t||0},path:r.getPath(),serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{range:r.range,background:r.background}}},unserialize:function(r){var t,e=this;return r&&e.name===r.filter&&(e._isOn=!!r._isOn,t=r.params,e.range=t.range,e.background=t.background),e},apply:function(r){var a=this;if(!a._isOn||!a.range||!a.range.length)return r;var i,l,o,s,u,c,f,h,p,m,d=r.length,g=a.range[0],v=a.range[a.range.length-1];for(p=n(a.background||0),s=~~t(p.r),u=~~t(p.g),c=~~t(p.b),f=~~t(p.a),h=0;d>h;h+=4)i=r[h],l=r[h+1],o=r[h+2],m=e({r:i,g:l,b:o}).h,(g>m||m>v)&&(r[h]=s,r[h+1]=u,r[h+2]=c,r[h+3]=f);return r}})}(r),!function(r){"use strict";{var t=(r._notSupportClamp,Math.min),e=Math.floor,n=r.CHANNEL.RED;r.CHANNEL.GREEN,r.CHANNEL.BLUE,r.CHANNEL.ALPHA}r.ChannelCopyFilter=r.Create({name:"ChannelCopyFilter",_srcImg:null,srcImg:null,centerX:0,centerY:0,srcChannel:0,dstChannel:0,init:function(r,t,e,a,i){var l=this;l._srcImg=null,l.srcImg=null,l.srcChannel=t||n,l.dstChannel=e||n,l.centerX=a||0,l.centerY=i||0,r&&l.setSrc(r)},path:r.getPath(),serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{_srcImg:r._srcImg,centerX:r.centerX,centerY:r.centerY,srcChannel:r.srcChannel,dstChannel:r.dstChannel}}},unserialize:function(r){var t,e=this;return r&&e.name===r.filter&&(e._isOn=!!r._isOn,t=r.params,e._srcImg=t._srcImg,e.centerX=t.centerX,e.centerY=t.centerY,e.srcChannel=t.srcChannel,e.dstChannel=t.dstChannel),e},setSrc:function(r){var t=this;return r&&(t.srcImg=r,t._srcImg={data:r.getData(),width:r.width,height:r.height}),t},apply:function(r,n,a){var i=this;if(!i._isOn||!i._srcImg)return r;var l,o,s,u,c,f,h=i._srcImg.data,p=r.length,m=(h.length,i._srcImg.width),d=i._srcImg.height,g=i.srcChannel,v=i.dstChannel,_=t(n,m),C=t(a,d),b=i.centerX||0,M=i.centerY||0,y=m>>1,O=d>>1;for(b=e(b*(n-1))-y,M=e(M*(a-1))-O,l=0,o=0,s=0,l=0;p>l;l+=4,o++)o>=n&&(o=0,s++),c=o-b,f=s-M,c>=0&&_>c&&f>=0&&C>f&&(u=c+f*m<<2,r[l+v]=h[u+g]);return r}})}(r),!function(r){"use strict";var t=(r._notSupportClamp,Math.min),e=Math.floor;r.AlphaMaskFilter=r.Create({name:"AlphaMaskFilter",_alphaMask:null,alphaMask:null,centerX:0,centerY:0,init:function(r,t,e){var n=this;n.centerX=t||0,n.centerY=e||0,n._alphaMask=null,n.alphaMask=null,r&&n.setMask(r)},path:r.getPath(),serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{_alphaMask:r._alphaMask,centerX:r.centerX,centerY:r.centerY}}},unserialize:function(r){var t,e=this;return r&&e.name===r.filter&&(e._isOn=!!r._isOn,t=r.params,e._alphaMask=t._alphaMask,e.centerX=t.centerX,e.centerY=t.centerY),e},setMask:function(r){var t=this;return r&&(t.alphaMask=r,t._alphaMask={data:r.getData(),width:r.width,height:r.height}),t},apply:function(r,n,a){var i=this;if(!i._isOn||!i._alphaMask)return r;var l,o,s,u,c,f,h=i._alphaMask.data,p=i._alphaMask.width,m=i._alphaMask.height,d=r.length,g=(h.length,t(n,p)),v=t(a,m),_=i.centerX||0,C=i.centerY||0,b=p>>1,M=m>>1;for(_=e(_*(n-1))-b,C=e(C*(a-1))-M,o=0,s=0,l=0;d>l;l+=4,o++)o>=n&&(o=0,s++),c=o-_,f=s-C,c>=0&&g>c&&f>=0&&v>f?(u=c+f*p<<2,r[l+3]=h[u+3]):r[l+3]=0;return r}})}(r),!function(r,t){"use strict";var e,n=Math.min,a=Math.max,i=Math.round,l=(Math.floor,Math.abs),o=r._notSupportClamp;r.BlendFilter=r.Create({name:"BlendFilter",_blendMode:null,_blendImage:null,blendMode:null,blendImage:null,startX:0,startY:0,amount:1,init:function(r,t,e){var n=this;n.startX=0,n.startY=0,n.amount=1,n._blendImage=null,n.blendImage=null,n._blendMode=null,n.blendMode=null,r&&n.setImage(r),t&&n.setMode(t,e)},path:r.getPath(),serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{_blendImage:r._blendImage,_blendMode:r._blendMode,startX:r.startX,startY:r.startY,amount:r.amount}}},unserialize:function(r){var t,e=this;return r&&e.name===r.filter&&(e._isOn=!!r._isOn,t=r.params,e._blendImage=t._blendImage,e.startX=t.startX,e.startY=t.startY,e.setMode(t._blendMode,t.amount)),e},setImage:function(r){var t=this;return r&&(t.blendImage=r,t._blendImage={data:r.getData(),width:r.width,height:r.height}),t},setMode:function(r,i){var l=this;return r?(l._blendMode=(""+r).toLowerCase(),l.blendMode=e[l._blendMode]||null,l.amount=a(0,n(1,t===i?1:i))):(l._blendMode=null,l.blendMode=null),l},reset:function(){var r=this;return r.startX=0,r.startY=0,r.amount=1,r._blendMode=null,r.blendMode=null,r},apply:function(r,t,e){var a=this;if(!a._isOn||!a.blendMode||!a._blendImage)return r;var l,o,s,u,c,f=a.startX||0,h=a.startY||0,p=0,m=0,d=a._blendImage,g=a.amount||1;return u=d.width,c=d.height,0>f&&(p=-f,f=0),0>h&&(m=-h,h=0),f>=t||h>=e?r:p>=u||m>=c?r:(f=i(f),h=i(h),p=i(p),m=i(m),l=n(t-f,u-p),o=n(e-h,c-m),0>=l||0>=o?r:(s=d.data,a.blendMode(r,t,e,s,u,c,f,h,p,m,l,o,g)))}}),e={normal:function(r,t,e,n,a,i,l,s,u,c,f,h,p){var m,d,g,v,_,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E;for(E=1-p,b=l,M=s*t,y=u,O=c*a,m=l+f,d=u+f,g=0,v=h*f;v>g;)_=b+M<<2,C=y+O<<2,F=r[_],z=r[_+1],I=r[_+2],Y=n[C],k=n[C+1],X=n[C+2],S=Y,x=k,w=X,F=S*p+F*E,z=x*p+z*E,I=w*p+I*E,o&&(F=0>F?0:F>255?255:F,z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I),r[_]=~~F,r[_+1]=~~z,r[_+2]=~~I,g++,b++,b>=m&&(b=l,M+=t),y++,y>=d&&(y=u,O+=a);return r},lighten:function(r,t,e,n,a,i,l,s,u,c,f,h,p){var m,d,g,v,_,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E;for(E=1-p,b=l,M=s*t,y=u,O=c*a,m=l+f,d=u+f,g=0,v=h*f;v>g;)_=b+M<<2,C=y+O<<2,F=r[_],z=r[_+1],I=r[_+2],Y=n[C],k=n[C+1],X=n[C+2],S=F>Y?F:Y,x=z>k?z:k,w=I>X?I:X,F=S*p+F*E,z=x*p+z*E,I=w*p+I*E,o&&(F=0>F?0:F>255?255:F,z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I),r[_]=~~F,r[_+1]=~~z,r[_+2]=~~I,g++,b++,b>=m&&(b=l,M+=t),y++,y>=d&&(y=u,O+=a);return r},darken:function(r,t,e,n,a,i,l,s,u,c,f,h,p){var m,d,g,v,_,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E;for(E=1-p,b=l,M=s*t,y=u,O=c*a,m=l+f,d=u+f,g=0,v=h*f;v>g;)_=b+M<<2,C=y+O<<2,F=r[_],z=r[_+1],I=r[_+2],Y=n[C],k=n[C+1],X=n[C+2],S=F>Y?Y:F,x=z>k?k:z,w=I>X?X:I,F=S*p+F*E,z=x*p+z*E,I=w*p+I*E,o&&(F=0>F?0:F>255?255:F,z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I),r[_]=~~F,r[_+1]=~~z,r[_+2]=~~I,g++,b++,b>=m&&(b=l,M+=t),y++,y>=d&&(y=u,O+=a);return r},multiply:function(r,t,e,n,a,i,l,s,u,c,f,h,p){var m,d,g,v,_,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E;for(E=1-p,b=l,M=s*t,y=u,O=c*a,m=l+f,d=u+f,g=0,v=h*f;v>g;)_=b+M<<2,C=y+O<<2,F=r[_],z=r[_+1],I=r[_+2],Y=n[C],k=n[C+1],X=n[C+2],S=F*Y*.003921568627451,x=z*k*.003921568627451,w=I*X*.003921568627451,F=S*p+F*E,z=x*p+z*E,I=w*p+I*E,o&&(F=0>F?0:F>255?255:F,z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I),r[_]=~~F,r[_+1]=~~z,r[_+2]=~~I,g++,b++,b>=m&&(b=l,M+=t),y++,y>=d&&(y=u,O+=a);return r},average:function(r,t,e,n,a,i,l,s,u,c,f,h,p){var m,d,g,v,_,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E;for(E=1-p,b=l,M=s*t,y=u,O=c*a,m=l+f,d=u+f,g=0,v=h*f;v>g;)_=b+M<<2,C=y+O<<2,F=r[_],z=r[_+1],I=r[_+2],Y=n[C],k=n[C+1],X=n[C+2],S=.5*(F+Y),x=.5*(z+k),w=.5*(I+X),F=S*p+F*E,z=x*p+z*E,I=w*p+I*E,o&&(F=0>F?0:F>255?255:F,z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I),r[_]=~~F,r[_+1]=~~z,r[_+2]=~~I,g++,b++,b>=m&&(b=l,M+=t),y++,y>=d&&(y=u,O+=a);return r},add:function(r,t,e,n,a,i,l,s,u,c,f,h,p){var m,d,g,v,_,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E;for(E=1-p,b=l,M=s*t,y=u,O=c*a,m=l+f,d=u+f,g=0,v=h*f;v>g;)_=b+M<<2,C=y+O<<2,F=r[_],z=r[_+1],I=r[_+2],Y=n[C],k=n[C+1],X=n[C+2],S=F+Y,x=z+k,w=I+X,F=S*p+F*E,z=x*p+z*E,I=w*p+I*E,o&&(F=0>F?0:F>255?255:F,z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I),r[_]=~~F,r[_+1]=~~z,r[_+2]=~~I,g++,b++,b>=m&&(b=l,M+=t),y++,y>=d&&(y=u,O+=a);return r},subtract:function(r,t,e,n,a,i,l,s,u,c,f,h,p){var m,d,g,v,_,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E;for(E=1-p,b=l,M=s*t,y=u,O=c*a,m=l+f,d=u+f,g=0,v=h*f;v>g;)_=b+M<<2,C=y+O<<2,F=r[_],z=r[_+1],I=r[_+2],Y=n[C],k=n[C+1],X=n[C+2],S=255>F+Y?0:F+Y-255,x=255>z+k?0:z+k-255,w=255>I+X?0:I+X-255,F=S*p+F*E,z=x*p+z*E,I=w*p+I*E,o&&(F=0>F?0:F>255?255:F,z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I),r[_]=~~F,r[_+1]=~~z,r[_+2]=~~I,g++,b++,b>=m&&(b=l,M+=t),y++,y>=d&&(y=u,O+=a);return r},difference:function(r,t,e,n,a,i,s,u,c,f,h,p,m){var d,g,v,_,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E,A;for(A=1-m,M=s,y=u*t,O=c,F=f*a,d=s+h,g=c+h,v=0,_=p*h;_>v;)C=M+y<<2,b=O+F<<2,z=r[C],I=r[C+1],Y=r[C+2],k=n[b],X=n[b+1],S=n[b+2],x=l(k-z),w=l(X-I),E=l(S-Y),z=x*m+z*A,I=w*m+I*A,Y=E*m+Y*A,o&&(z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I,Y=0>Y?0:Y>255?255:Y),r[C]=~~z,r[C+1]=~~I,r[C+2]=~~Y,v++,M++,M>=d&&(M=s,y+=t),O++,O>=g&&(O=c,F+=a);return r},negation:function(r,t,e,n,a,i,s,u,c,f,h,p,m){var d,g,v,_,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E,A;for(A=1-m,M=s,y=u*t,O=c,F=f*a,d=s+h,g=c+h,v=0,_=p*h;_>v;)C=M+y<<2,b=O+F<<2,z=r[C],I=r[C+1],Y=r[C+2],k=n[b],X=n[b+1],S=n[b+2],x=255-l(255-k-z),w=255-l(255-X-I),E=255-l(255-S-Y),z=x*m+z*A,I=w*m+I*A,Y=E*m+Y*A,o&&(z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I,Y=0>Y?0:Y>255?255:Y),r[C]=~~z,r[C+1]=~~I,r[C+2]=~~Y,v++,M++,M>=d&&(M=s,y+=t),O++,O>=g&&(O=c,F+=a);return r},screen:function(r,t,e,n,a,i,l,s,u,c,f,h,p){var m,d,g,v,_,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E;for(E=1-p,b=l,M=s*t,y=u,O=c*a,m=l+f,d=u+f,g=0,v=h*f;v>g;)_=b+M<<2,C=y+O<<2,F=r[_],z=r[_+1],I=r[_+2],Y=n[C],k=n[C+1],X=n[C+2],S=255-((255-Y)*(255-F)>>8),x=255-((255-k)*(255-z)>>8),w=255-((255-X)*(255-I)>>8),F=S*p+F*E,z=x*p+z*E,I=w*p+I*E,o&&(F=0>F?0:F>255?255:F,z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I),r[_]=~~F,r[_+1]=~~z,r[_+2]=~~I,g++,b++,b>=m&&(b=l,M+=t),y++,y>=d&&(y=u,O+=a);return r},exclusion:function(r,t,e,n,a,i,l,s,u,c,f,h,p){var m,d,g,v,_,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E;for(E=1-p,b=l,M=s*t,y=u,O=c*a,m=l+f,d=u+f,g=0,v=h*f;v>g;)_=b+M<<2,C=y+O<<2,F=r[_],z=r[_+1],I=r[_+2],Y=n[C],k=n[C+1],X=n[C+2],S=Y+F-2*Y*F*.003921568627451,x=k+z-2*k*z*.003921568627451,w=X+I-2*X*I*.003921568627451,F=S*p+F*E,z=x*p+z*E,I=w*p+I*E,o&&(F=0>F?0:F>255?255:F,z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I),r[_]=~~F,r[_+1]=~~z,r[_+2]=~~I,g++,b++,b>=m&&(b=l,M+=t),y++,y>=d&&(y=u,O+=a);return r},overlay:function(r,t,e,n,a,i,l,s,u,c,f,h,p){var m,d,g,v,_,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E;for(E=1-p,b=l,M=s*t,y=u,O=c*a,m=l+f,d=u+f,g=0,v=h*f;v>g;)_=b+M<<2,C=y+O<<2,F=r[_],z=r[_+1],I=r[_+2],Y=n[C],k=n[C+1],X=n[C+2],S=128>F?2*Y*F*.003921568627451:255-2*(255-Y)*(255-F)*.003921568627451,x=128>z?2*k*z*.003921568627451:255-2*(255-k)*(255-z)*.003921568627451,S=128>I?2*X*I*.003921568627451:255-2*(255-X)*(255-I)*.003921568627451,F=S*p+F*E,z=x*p+z*E,I=w*p+I*E,o&&(F=0>F?0:F>255?255:F,z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I),r[_]=~~F,r[_+1]=~~z,r[_+2]=~~I,g++,b++,b>=m&&(b=l,M+=t),y++,y>=d&&(y=u,O+=a);return r},softlight:function(r,t,e,n,a,i,l,s,u,c,f,h,p){var m,d,g,v,_,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E;for(E=1-p,b=l,M=s*t,y=u,O=c*a,m=l+f,d=u+f,g=0,v=h*f;v>g;)_=b+M<<2,C=y+O<<2,F=r[_],z=r[_+1],I=r[_+2],Y=n[C],k=n[C+1],X=n[C+2],S=128>F?2*((Y>>1)+64)*.003921568627451*F:255-2*(255-((Y>>1)+64))*(255-F)*.003921568627451,x=128>z?2*((k>>1)+64)*.003921568627451*z:255-2*(255-((k>>1)+64))*(255-z)*.003921568627451,w=128>I?2*((X>>1)+64)*.003921568627451*I:255-2*(255-((X>>1)+64))*(255-I)*.003921568627451,F=S*p+F*E,z=x*p+z*E,I=w*p+I*E,o&&(F=0>F?0:F>255?255:F,z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I),r[_]=~~F,r[_+1]=~~z,r[_+2]=~~I,g++,b++,b>=m&&(b=l,M+=t),y++,y>=d&&(y=u,O+=a);return r},hardlight:function(r,t,e,n,a,i,l,s,u,c,f,h,p){var m,d,g,v,_,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E;for(E=1-p,b=l,M=s*t,y=u,O=c*a,m=l+f,d=u+f,g=0,v=h*f;v>g;)_=b+M<<2,C=y+O<<2,F=r[_],z=r[_+1],I=r[_+2],Y=n[C],k=n[C+1],X=n[C+2],S=128>Y?2*F*Y*.003921568627451:255-2*(255-F)*(255-Y)*.003921568627451,x=128>k?2*z*k*.003921568627451:255-2*(255-z)*(255-k)*.003921568627451,w=128>X?2*I*X*.003921568627451:255-2*(255-I)*(255-X)*.003921568627451,F=S*p+F*E,z=x*p+z*E,I=w*p+I*E,o&&(F=0>F?0:F>255?255:F,z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I),r[_]=~~F,r[_+1]=~~z,r[_+2]=~~I,g++,b++,b>=m&&(b=l,M+=t),y++,y>=d&&(y=u,O+=a);return r},colordodge:function(r,t,e,a,i,l,s,u,c,f,h,p,m){var d,g,v,_,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E,A;for(A=1-m,M=s,y=u*t,O=c,F=f*i,d=s+h,g=c+h,v=0,_=p*h;_>v;)C=M+y<<2,b=O+F<<2,z=r[C],I=r[C+1],Y=r[C+2],k=a[b],X=a[b+1],S=a[b+2],x=255==z?z:n(255,(k<<8)/(255-z)),w=255==I?I:n(255,(X<<8)/(255-I)),E=255==Y?z:n(255,(S<<8)/(255-Y)),z=x*m+z*A,I=w*m+I*A,Y=E*m+Y*A,o&&(z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I,Y=0>Y?0:Y>255?255:Y),r[C]=~~z,r[C+1]=~~I,r[C+2]=~~Y,v++,M++,M>=d&&(M=s,y+=t),O++,O>=g&&(O=c,F+=i);return r},colorburn:function(r,t,e,n,i,l,s,u,c,f,h,p,m){var d,g,v,_,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E,A;for(A=1-m,M=s,y=u*t,O=c,F=f*i,d=s+h,g=c+h,v=0,_=p*h;_>v;)C=M+y<<2,b=O+F<<2,z=r[C],I=r[C+1],Y=r[C+2],k=n[b],X=n[b+1],S=n[b+2],x=0==z?z:a(0,255-(255-k<<8)/z),w=0==I?I:a(0,255-(255-X<<8)/I),E=0==Y?Y:a(0,255-(255-S<<8)/Y),z=x*m+z*A,I=w*m+I*A,Y=E*m+Y*A,o&&(z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I,Y=0>Y?0:Y>255?255:Y),r[C]=~~z,r[C+1]=~~I,r[C+2]=~~Y,v++,M++,M>=d&&(M=s,y+=t),O++,O>=g&&(O=c,F+=i);return r},linearlight:function(r,t,e,n,a,i,l,s,u,c,f,h,p){var m,d,g,v,_,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E;E=1-p,b=l,M=s*t,y=u,O=c*a,m=l+f,d=u+f,g=0,v=h*f;for(var A;v>g;)_=b+M<<2,C=y+O<<2,F=r[_],z=r[_+1],I=r[_+2],Y=n[C],k=n[C+1],X=n[C+2],128>F?(A=2*F,S=255>A+Y?0:A+Y-255):(A=2*(F-128),S=A+Y),128>z?(A=2*z,x=255>A+k?0:A+k-255):(A=2*(z-128),x=A+k),128>I?(A=2*I,w=255>A+X?0:A+X-255):(A=2*(I-128),w=A+X),F=S*p+F*E,z=x*p+z*E,I=w*p+I*E,o&&(F=0>F?0:F>255?255:F,z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I),r[_]=~~F,r[_+1]=~~z,r[_+2]=~~I,g++,b++,b>=m&&(b=l,M+=t),y++,y>=d&&(y=u,O+=a);return r},reflect:function(r,t,e,a,i,l,s,u,c,f,h,p,m){var d,g,v,_,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E,A;for(A=1-m,M=s,y=u*t,O=c,F=f*i,d=s+h,g=c+h,v=0,_=p*h;_>v;)C=M+y<<2,b=O+F<<2,z=r[C],I=r[C+1],Y=r[C+2],k=a[b],X=a[b+1],S=a[b+2],x=255==z?z:n(255,k*k/(255-z)),w=255==I?I:n(255,X*X/(255-I)),E=255==Y?Y:n(255,S*S/(255-Y)),z=x*m+z*A,I=w*m+I*A,Y=E*m+Y*A,o&&(z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I,Y=0>Y?0:Y>255?255:Y),r[C]=~~z,r[C+1]=~~I,r[C+2]=~~Y,v++,M++,M>=d&&(M=s,y+=t),O++,O>=g&&(O=c,F+=i);return r},glow:function(r,t,e,a,i,l,s,u,c,f,h,p,m){var d,g,v,_,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E,A;for(A=1-m,M=s,y=u*t,O=c,F=f*i,d=s+h,g=c+h,v=0,_=p*h;_>v;)C=M+y<<2,b=O+F<<2,z=r[C],I=r[C+1],Y=r[C+2],k=a[b],X=a[b+1],S=a[b+2],x=255==k?k:n(255,z*z/(255-k)),w=255==X?X:n(255,I*I/(255-X)),E=255==S?S:n(255,Y*Y/(255-S)),z=x*m+z*A,I=w*m+I*A,Y=E*m+Y*A,o&&(z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I,Y=0>Y?0:Y>255?255:Y),r[C]=~~z,r[C+1]=~~I,r[C+2]=~~Y,v++,M++,M>=d&&(M=s,y+=t),O++,O>=g&&(O=c,F+=i);return r},phoenix:function(r,t,e,i,l,s,u,c,f,h,p,m,d){var g,v,_,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E,A,P;for(P=1-d,y=u,O=c*t,F=f,z=h*l,g=u+p,v=f+p,_=0,C=m*p;C>_;)b=y+O<<2,M=F+z<<2,I=r[b],Y=r[b+1],k=r[b+2],X=i[M],S=i[M+1],x=i[M+2],w=n(X,I)-a(X,I)+255,E=n(S,Y)-a(S,Y)+255,A=n(x,k)-a(x,k)+255,I=w*d+I*P,Y=E*d+Y*P,k=A*d+k*P,o&&(I=0>I?0:I>255?255:I,Y=0>Y?0:Y>255?255:Y,k=0>k?0:k>255?255:k),r[b]=~~I,r[b+1]=~~Y,r[b+2]=~~k,_++,y++,y>=g&&(y=u,O+=t),F++,F>=v&&(F=f,z+=l);return r},vividlight:function(r,t,e,i,l,s,u,c,f,h,p,m,d){var g,v,_,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E,A,P;P=1-d,y=u,O=c*t,F=f,z=h*l,g=u+p,v=f+p,_=0,C=m*p;for(var q;C>_;)b=y+O<<2,M=F+z<<2,I=r[b],Y=r[b+1],k=r[b+2],X=i[M],S=i[M+1],x=i[M+2],128>I?(q=2*I,w=0==q?q:a(0,255-(255-X<<8)/q)):(q=2*(I-128),w=255==q?q:n(255,(X<<8)/(255-q))),128>Y?(q=2*Y,E=0==q?q:a(0,255-(255-S<<8)/q)):(q=2*(Y-128),E=255==q?q:n(255,(S<<8)/(255-q))),128>k?(q=2*k,A=0==q?q:a(0,255-(255-x<<8)/q)):(q=2*(Y-128),A=255==q?q:n(255,(x<<8)/(255-q))),I=w*d+I*P,Y=E*d+Y*P,k=A*d+k*P,o&&(I=0>I?0:I>255?255:I,Y=0>Y?0:Y>255?255:Y,k=0>k?0:k>255?255:k),r[b]=~~I,r[b+1]=~~Y,r[b+2]=~~k,_++,y++,y>=g&&(y=u,O+=t),F++,F>=v&&(F=f,z+=l);return r},pinlight:function(r,t,e,n,a,i,l,s,u,c,f,h,p){var m,d,g,v,_,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E;E=1-p,b=l,M=s*t,y=u,O=c*a,m=l+f,d=u+f,g=0,v=h*f;for(var A;v>g;)_=b+M<<2,C=y+O<<2,F=r[_],z=r[_+1],I=r[_+2],Y=n[C],k=n[C+1],X=n[C+2],128>F?(A=2*F,S=A>Y?A:Y):(A=2*(F-128),S=A>Y?Y:A),128>z?(A=2*z,x=A>k?A:k):(A=2*(F-128),x=A>k?k:A),128>I?(A=2*I,w=A>X?A:X):(A=2*(I-128),w=A>X?X:A),F=S*p+F*E,z=x*p+z*E,I=w*p+I*E,o&&(F=0>F?0:F>255?255:F,z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I),r[_]=~~F,r[_+1]=~~z,r[_+2]=~~I,g++,b++,b>=m&&(b=l,M+=t),y++,y>=d&&(y=u,O+=a);return r},hardmix:function(r,t,e,i,l,s,u,c,f,h,p,m,d){var g,v,_,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E,A,P;P=1-d,y=u,O=c*t,F=f,z=h*l,g=u+p,v=f+p,_=0,C=m*p;for(var q;C>_;)b=y+O<<2,M=F+z<<2,I=r[b],Y=r[b+1],k=r[b+2],X=i[M],S=i[M+1],x=i[M+2],128>I?(q=2*I,w=0==q?q:a(0,255-(255-X<<8)/q)):(q=2*(I-128),w=255==q?q:n(255,(X<<8)/(255-q))),w=128>w?0:255,128>Y?(q=2*Y,E=0==q?q:a(0,255-(255-S<<8)/q)):(q=2*(Y-128),E=255==q?q:n(255,(S<<8)/(255-q))),E=128>E?0:255,128>k?(q=2*k,A=0==q?q:a(0,255-(255-x<<8)/q)):(q=2*(k-128),A=255==q?q:n(255,(x<<8)/(255-q))),A=128>A?0:255,I=w*d+I*P,Y=E*d+Y*P,k=A*d+k*P,o&&(I=0>I?0:I>255?255:I,Y=0>Y?0:Y>255?255:Y,k=0>k?0:k>255?255:k),r[b]=~~I,r[b+1]=~~Y,r[b+2]=~~k,_++,y++,y>=g&&(y=u,O+=t),F++,F>=v&&(F=f,z+=l);return r}},e.lineardodge=e.add,e.linearburn=e.subtract}(r),!function(r){"use strict";var t=(r._notSupportClamp,r.Color.RGBA2Color),e=r.Color.Color2RGBA;r.ThresholdFilter=r.Create({name:"ThresholdFilter",thresholds:null,quantizedColors:null,init:function(r,t){var e=this;e.thresholds=r,e.quantizedColors=t||null},path:r.getPath(),serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{thresholds:r.thresholds,quantizedColors:r.quantizedColors}}},unserialize:function(r){var t,e=this;return r&&e.name===r.filter&&(e._isOn=!!r._isOn,t=r.params,e.thresholds=t.thresholds,e.quantizedColors=t.quantizedColors),e},apply:function(r){var n=this;if(!(n._isOn&&n.thresholds&&n.thresholds.length&&n.quantizedColors&&n.quantizedColors.length))return r;var a,i,l,o,s,u,c,f,h=r.length,p=n.thresholds,m=p.length,d=n.quantizedColors,g=d.length;for(c=0;h>c;c+=4){for(s=t({r:r[c],g:r[c+1],b:r[c+2],a:r[c+3]}),f=0;m>f&&s>p[f];)f++;s=g>f?d[f]:255,u=e(s),a=u.r,i=u.g,l=u.b,o=u.a,r[c]=a,r[c+1]=i,r[c+2]=l,r[c+3]=o}return r}})}(r),!function(r){"use strict";var t=(Math.sqrt,Math.exp,Math.log),e=Math.abs,n=Math.floor,a=r._notSupportClamp,i=r.Array32F;r.BokehFilter=r.Create({name:"BokehFilter",centerX:0,centerY:0,radius:10,amount:10,init:function(r,t,e,n){var a=this;a.centerX=r||0,a.centerY=t||0,a.radius=e||10,a.amount=n||10},path:r.getPath(),serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{centerX:r.centerX,centerY:r.centerY,radius:r.radius,amount:r.amount}}},unserialize:function(r){var t,e=this;return r&&e.name===r.filter&&(e._isOn=!!r._isOn,t=r.params,e.centerX=t.centerX,e.centerY=t.centerY,e.radius=t.radius,e.amount=t.amount),e},apply:function(r,l,o){var s=this;if(!s._isOn)return r;var u,c,f,h,p,m,d,g,v,_,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E,A,P,q,H,B,N,R,G,L=r.length,T=s.centerX||0,j=s.centerY||0,V=s.radius,D=s.amount;if(0>=D)return r;for(u=L>>2,B=0,N=l-1,R=0,G=u-l,T=n(T*(l-1)),j=n(j*(o-1)),f=(u<<1)+u,d=(l<<1)+l,c=new i(f),g=0,v=0,_=0,h=p=m=0,_=0;l>_;_++,g+=4,v+=3)h+=r[g],p+=r[g+1],m+=r[g+2],c[v]=h,c[v+1]=p,c[v+2]=m;for(g=d+l,v=0,_=0,h=p=m=0,g=d+l;L>g;g+=4,v+=3,_++)_>=l&&(_=0,h=p=m=0),h+=r[g],p+=r[g+1],m+=r[g+2],c[v+d]=c[v]+h,c[v+d+1]=c[v+1]+p,c[v+d+2]=c[v+2]+m;for(_=0,C=0,b=0,g=0;L>g;g+=4,_++)_>=l&&(_=0,C++,b+=l),y=_-T,O=C-j,M=e(y)+e(O),F=M>V?~~t((M-V)*D):~~(M/V+.5),F>0&&(z=F*l,I=.25/(F*F),Y=_-F,k=b-z,X=_+F,S=b+z,B>Y?Y=B:X>N&&(X=N),R>k?k=R:S>G&&(S=G),x=Y+k,A=X+S,w=X+k,E=Y+S,x=(x<<1)+x,w=(w<<1)+w,E=(E<<1)+E,A=(A<<1)+A,P=I*(c[A]-c[w]-c[E]+c[x]),q=I*(c[A+1]-c[w+1]-c[E+1]+c[x+1]),H=I*(c[A+2]-c[w+2]-c[E+2]+c[x+2]),a&&(P=0>P?0:P>255?255:P,q=0>q?0:q>255?255:q,H=0>H?0:H>255?255:H),r[g]=~~P,r[g+1]=~~q,r[g+2]=~~H);return r}})}(r),t});